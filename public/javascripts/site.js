// Generated by CoffeeScript 1.7.1
$(function() {
  var get_profile_by_name, init_sidebar_profile_list;
  init_sidebar_profile_list = function() {
    $.get('/data/profile/all', function(data) {
      var i, p, s_list, tmp, _i, _len, _ref;
      s_list = $("#sidebar_profile_list");
      s_list.empty();
      _ref = data['ret'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        i = _ref[_i];
        p = i['profile'];
        tmp = document.createElement("a");
        $(tmp).addClass("btn btn-default");
        $(tmp).attr("name", "" + p);
        $(tmp).text("" + p);
        $(tmp).bind('click', function() {
          return get_profile_by_name($(this).attr("name"));
        });
        s_list.append(tmp);
      }
    });
  };
  get_profile_by_name = function(name) {
    var get_detail_by_sid, insert_row_into_table;
    $.get("/data/profile/by/" + name, function(data) {
      var k, kargs, l, ret, row, s_kargs, state, td, top, v, _i, _len, _results;
      ret = data['ret'];
      top = $("#main_tbody");
      top.empty();
      _results = [];
      for (_i = 0, _len = ret.length; _i < _len; _i++) {
        l = ret[_i];
        row = document.createElement("tr");
        for (k in l) {
          v = l[k];
          td = document.createElement("td");
          if (k === "state") {
            state = document.createElement('span');
            if (v === 1) {
              $(state).addClass("label label-danger");
              $(state).text("Failed");
            } else {
              $(state).addClass("label label-success");
              $(state).text("Passed");
            }
            $(state).attr("name", l['session_id']);
            $(state).bind('click', get_detail_by_sid);
            $(td).append(state);
          } else if (k === "additional_kargs") {
            s_kargs = v.slice(0, 40);
            kargs = "<abbr title=\"" + v + "\">" + s_kargs + "</abbr>";
            $(td).append(kargs);
          } else {
            $(td).text(v);
          }
          $(row).append(td);
        }
        _results.push(top.append(row));
      }
      return _results;
    });
    insert_row_into_table = function(start, len, data, s_id) {
      var ary, c, ch, i, k, r, rh, s, t, tb, url, v, _i, _j, _k, _len, _len1, _ref, _ref1, _ref2, _ref3, _results;
      tb = document.getElementById('main_tbody');
      rh = tb.insertRow(start);
      $(rh).addClass("info " + s_id + "_exp");
      _ref = ['JobId', 'CaseName', 'Result', 'Bugzilla ID', 'Detail'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        t = _ref[_i];
        ch = rh.insertCell(-1);
        ch.innerHTML = "<span class='label label-warning'>" + t + "</span>";
      }
      _results = [];
      for (i = _j = _ref1 = start + 1, _ref2 = start + len; _ref1 <= _ref2 ? _j <= _ref2 : _j >= _ref2; i = _ref1 <= _ref2 ? ++_j : --_j) {
        r = tb.insertRow(i);
        $(r).addClass("info " + s_id + "_exp");
        _ref3 = data.shift();
        for (k in _ref3) {
          v = _ref3[k];
          if (k === 'annotations' && v !== '') {
            c = r.insertCell(-1);
            ary = v.split(',');
            s = "";
            for (_k = 0, _len1 = ary.length; _k < _len1; _k++) {
              url = ary[_k];
              s += "<a href=\"http://bugzilla.redhat.com/show_bug.cgi?id=" + v + "\" target=\"_blank\">" + v + "</a>";
            }
            c.innerHTML = s;
          } else {
            c = r.insertCell(-1);
            c.innerHTML = v;
          }
        }
        c = r.insertCell(-1);
        _results.push(c.innerHTML = "<button class='btn btn-default btn-sm'>Full Log</button>");
      }
      return _results;
    };
    return get_detail_by_sid = function() {
      var s_id, s_index;
      s_id = $(this).attr('name');
      if (!$("." + s_id + "_exp").length) {
        s_index = $(this.parentNode.parentNode).index() + 1;
        return $.get("/data/details/by/" + s_id, function(data) {
          var ret;
          ret = data['ret'];
          return insert_row_into_table(s_index, ret.length, ret, s_id);
        });
      } else {
        return $("." + s_id + "_exp").remove();
      }
    };
  };
  return init_sidebar_profile_list();
});
